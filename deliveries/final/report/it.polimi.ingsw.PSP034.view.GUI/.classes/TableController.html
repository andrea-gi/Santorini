


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: TableController</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">it.polimi.ingsw.PSP034.view.GUI</a> ]
</div>

<h1>Coverage Summary for Class: TableController (it.polimi.ingsw.PSP034.view.GUI)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TableController</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 32)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 362)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TableController$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TableController$CurrentPhase</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TableController$EndGameButtons</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 35)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 372)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;package it.polimi.ingsw.PSP034.view.GUI;
<i>2</i>&nbsp;
<i>3</i>&nbsp;import it.polimi.ingsw.PSP034.constants.*;
<i>4</i>&nbsp;import it.polimi.ingsw.PSP034.messages.Answer;
<i>5</i>&nbsp;import it.polimi.ingsw.PSP034.messages.SlimBoard;
<i>6</i>&nbsp;import it.polimi.ingsw.PSP034.messages.clientConfiguration.ErrorMessage;
<i>7</i>&nbsp;import it.polimi.ingsw.PSP034.messages.playPhase.AnswerAction;
<i>8</i>&nbsp;import it.polimi.ingsw.PSP034.messages.playPhase.AnswerBooleanChoice;
<i>9</i>&nbsp;import it.polimi.ingsw.PSP034.messages.playPhase.RequestAction;
<i>10</i>&nbsp;import it.polimi.ingsw.PSP034.messages.playPhase.RequiredActions;
<i>11</i>&nbsp;import it.polimi.ingsw.PSP034.messages.setupPhase.AnswerPlaceWorker;
<i>12</i>&nbsp;import it.polimi.ingsw.PSP034.view.GodDescription;
<i>13</i>&nbsp;import javafx.animation.FadeTransition;
<i>14</i>&nbsp;import javafx.collections.ObservableList;
<i>15</i>&nbsp;import javafx.event.ActionEvent;
<i>16</i>&nbsp;import javafx.fxml.FXML;
<i>17</i>&nbsp;import javafx.geometry.Insets;
<i>18</i>&nbsp;import javafx.geometry.Pos;
<i>19</i>&nbsp;import javafx.scene.Node;
<i>20</i>&nbsp;import javafx.scene.Scene;
<i>21</i>&nbsp;import javafx.scene.control.*;
<i>22</i>&nbsp;import javafx.scene.image.Image;
<i>23</i>&nbsp;import javafx.scene.image.ImageView;
<i>24</i>&nbsp;import javafx.scene.input.MouseEvent;
<i>25</i>&nbsp;import javafx.scene.layout.AnchorPane;
<i>26</i>&nbsp;import javafx.scene.layout.GridPane;
<i>27</i>&nbsp;import javafx.scene.layout.Pane;
<i>28</i>&nbsp;import javafx.scene.layout.StackPane;
<i>29</i>&nbsp;import javafx.scene.paint.Color;
<i>30</i>&nbsp;import javafx.scene.shape.Rectangle;
<i>31</i>&nbsp;import javafx.util.Duration;
<i>32</i>&nbsp;
<i>33</i>&nbsp;import java.util.ArrayList;
<i>34</i>&nbsp;
<i>35</i>&nbsp;/** It controls the GUI scene of the board
<i>36</i>&nbsp; */
<b class="nc"><i>37</i>&nbsp;public class TableController implements GUIController{</b>
<i>38</i>&nbsp;
<i>39</i>&nbsp;    @FXML
<i>40</i>&nbsp;    private Pane pane;
<i>41</i>&nbsp;
<i>42</i>&nbsp;    @FXML
<i>43</i>&nbsp;    private GridPane gridTable;
<i>44</i>&nbsp;
<i>45</i>&nbsp;    @FXML
<i>46</i>&nbsp;    private GridPane gridCard;
<i>47</i>&nbsp;
<i>48</i>&nbsp;    @FXML
<i>49</i>&nbsp;    private Label title;
<i>50</i>&nbsp;
<i>51</i>&nbsp;    @FXML
<i>52</i>&nbsp;    private Label message;
<i>53</i>&nbsp;
<i>54</i>&nbsp;    @FXML
<i>55</i>&nbsp;    private ImageView cardOne;
<i>56</i>&nbsp;
<i>57</i>&nbsp;    @FXML
<i>58</i>&nbsp;    private ImageView cardTwo;
<i>59</i>&nbsp;
<i>60</i>&nbsp;    @FXML
<i>61</i>&nbsp;    private ImageView cardThree;
<i>62</i>&nbsp;
<i>63</i>&nbsp;    @FXML
<i>64</i>&nbsp;    private Label nameOne;
<i>65</i>&nbsp;
<i>66</i>&nbsp;    @FXML
<i>67</i>&nbsp;    private Label nameTwo;
<i>68</i>&nbsp;
<i>69</i>&nbsp;    @FXML
<i>70</i>&nbsp;    private Label nameThree;
<i>71</i>&nbsp;
<i>72</i>&nbsp;    @FXML
<i>73</i>&nbsp;    private ImageView godOne;
<i>74</i>&nbsp;
<i>75</i>&nbsp;    @FXML
<i>76</i>&nbsp;    private ImageView powerOne;
<i>77</i>&nbsp;
<i>78</i>&nbsp;    @FXML
<i>79</i>&nbsp;    private ImageView godTwo;
<i>80</i>&nbsp;
<i>81</i>&nbsp;    @FXML
<i>82</i>&nbsp;    private ImageView powerTwo;
<i>83</i>&nbsp;
<i>84</i>&nbsp;    @FXML
<i>85</i>&nbsp;    private ImageView godThree;
<i>86</i>&nbsp;
<i>87</i>&nbsp;    @FXML
<i>88</i>&nbsp;    private ImageView powerThree;
<i>89</i>&nbsp;
<i>90</i>&nbsp;    @FXML
<i>91</i>&nbsp;    private ImageView usePower;
<i>92</i>&nbsp;
<i>93</i>&nbsp;    @FXML
<i>94</i>&nbsp;    private Label description;
<i>95</i>&nbsp;
<i>96</i>&nbsp;    @FXML
<i>97</i>&nbsp;    private Button submitPower;
<i>98</i>&nbsp;
<i>99</i>&nbsp;    @FXML
<i>100</i>&nbsp;    private ToggleButton togglePower;
<i>101</i>&nbsp;
<b class="nc"><i>102</i>&nbsp;    Label victoryMessage = new Label();</b>
<i>103</i>&nbsp;
<b class="nc"><i>104</i>&nbsp;    private final boolean[][] canSend = new boolean[Constant.DIM][Constant.DIM];</b>
<i>105</i>&nbsp;
<i>106</i>&nbsp;    @FXML
<i>107</i>&nbsp;    private void initialize() {
<b class="nc"><i>108</i>&nbsp;        GUIRequestHub.getInstance().setCurrentController(this);</b>
<b class="nc"><i>109</i>&nbsp;        pane.setId(&quot;boardScene&quot;);</b>
<b class="nc"><i>110</i>&nbsp;        title.setId(&quot;boardTitle&quot;);</b>
<b class="nc"><i>111</i>&nbsp;        message.setId(&quot;boardSubtitle&quot;);</b>
<b class="nc"><i>112</i>&nbsp;        description.setId(&quot;boardSubtitle&quot;);</b>
<b class="nc"><i>113</i>&nbsp;        togglePower.setVisible(false);</b>
<b class="nc"><i>114</i>&nbsp;        submitPower.setVisible(false);</b>
<b class="nc"><i>115</i>&nbsp;        togglePower.setId(&quot;selectPower&quot;);</b>
<b class="nc"><i>116</i>&nbsp;        submitPower.setDisable(true);</b>
<b class="nc"><i>117</i>&nbsp;        usePower.setImage(new Image(&quot;images/box.png&quot;));</b>
<b class="nc"><i>118</i>&nbsp;        usePower.setVisible(true);</b>
<b class="nc"><i>119</i>&nbsp;        victoryMessage.setId(&quot;victoryLabel&quot;);</b>
<i>120</i>&nbsp;    }
<i>121</i>&nbsp;
<i>122</i>&nbsp;    private Sex answerSex;
<i>123</i>&nbsp;
<i>124</i>&nbsp;    private CurrentPhase currentPhase;
<i>125</i>&nbsp;
<b class="nc"><i>126</i>&nbsp;    private Rectangle blackOverlay = new Rectangle(1280,720, Color.rgb(0,0,0,0.6));</b>
<i>127</i>&nbsp;
<b class="nc"><i>128</i>&nbsp;    private enum CurrentPhase{</b>
<b class="nc"><i>129</i>&nbsp;        PLACE_WORKER,</b>
<b class="nc"><i>130</i>&nbsp;        WORKER_CHOICE,</b>
<b class="nc"><i>131</i>&nbsp;        MOVE_REQUEST,</b>
<b class="nc"><i>132</i>&nbsp;        BUILD_REQUEST,</b>
<i>133</i>&nbsp;    }
<i>134</i>&nbsp;
<b class="nc"><i>135</i>&nbsp;    private enum EndGameButtons{</b>
<b class="nc"><i>136</i>&nbsp;        PLAY_AGAIN,</b>
<b class="nc"><i>137</i>&nbsp;        KEEP_WATCHING</b>
<i>138</i>&nbsp;    }
<i>139</i>&nbsp;
<i>140</i>&nbsp;    @Override
<i>141</i>&nbsp;    public Pane getPane() {
<b class="nc"><i>142</i>&nbsp;        return pane;</b>
<i>143</i>&nbsp;    }
<i>144</i>&nbsp;
<i>145</i>&nbsp;    void setMyTitle(String string){
<b class="nc"><i>146</i>&nbsp;        title.setText(string);</b>
<i>147</i>&nbsp;    }
<i>148</i>&nbsp;
<i>149</i>&nbsp;    void setMyDescription(String string){
<b class="nc"><i>150</i>&nbsp;        description.setText(string);</b>
<i>151</i>&nbsp;    }
<i>152</i>&nbsp;
<i>153</i>&nbsp;    void setVisibleBox(boolean bool){
<b class="nc"><i>154</i>&nbsp;        usePower.setVisible(bool);</b>
<i>155</i>&nbsp;    }
<i>156</i>&nbsp;
<i>157</i>&nbsp;    /** Gets the card using the player&#39;s name
<i>158</i>&nbsp;     * @param name is the player&#39;s name
<i>159</i>&nbsp;     * @return the anchorPane where it lays the player&#39;s card
<i>160</i>&nbsp;     */
<i>161</i>&nbsp;    private AnchorPane getCardByUser(String name){
<b class="nc"><i>162</i>&nbsp;        Node card = null;</b>
<b class="nc"><i>163</i>&nbsp;        if(name.equals(nameOne.getText()))</b>
<b class="nc"><i>164</i>&nbsp;            card = getTileByIndex(0,0, gridCard);</b>
<b class="nc"><i>165</i>&nbsp;        else if (name.equals(nameTwo.getText()))</b>
<b class="nc"><i>166</i>&nbsp;            card = getTileByIndex(1,0, gridCard);</b>
<b class="nc"><i>167</i>&nbsp;        else if (name.equals(nameThree.getText()))</b>
<b class="nc"><i>168</i>&nbsp;            card = getTileByIndex(2,0, gridCard);</b>
<i>169</i>&nbsp;
<b class="nc"><i>170</i>&nbsp;        if (card instanceof AnchorPane)</b>
<b class="nc"><i>171</i>&nbsp;            return (AnchorPane) card;</b>
<b class="nc"><i>172</i>&nbsp;        else return null;</b>
<i>173</i>&nbsp;    }
<i>174</i>&nbsp;
<i>175</i>&nbsp;    /** Sets the opacity of the card in case of game over of a single player
<i>176</i>&nbsp;     * @param name is the player&#39;s name
<i>177</i>&nbsp;     * @param opacity indicates the level of opacity desired
<i>178</i>&nbsp;     */
<i>179</i>&nbsp;    void setCardOpacity(String name, double opacity){
<b class="nc"><i>180</i>&nbsp;        AnchorPane loserCard = getCardByUser(name);</b>
<b class="nc"><i>181</i>&nbsp;        if (loserCard != null){</b>
<b class="nc"><i>182</i>&nbsp;            loserCard.setOpacity(opacity);</b>
<i>183</i>&nbsp;        }
<i>184</i>&nbsp;    }
<i>185</i>&nbsp;
<i>186</i>&nbsp;    /** Gets the image of the god depending on the player&#39;s name
<i>187</i>&nbsp;     * @param name is the name of the player
<i>188</i>&nbsp;     * @return the god image associated to the player
<i>189</i>&nbsp;     */
<i>190</i>&nbsp;    private Image getGodImageByUser(String name){
<b class="nc"><i>191</i>&nbsp;        Image image = null;</b>
<b class="nc"><i>192</i>&nbsp;        if(name.equals(nameOne.getText())) {</b>
<b class="nc"><i>193</i>&nbsp;            if (godOne.getImage() != null)</b>
<b class="nc"><i>194</i>&nbsp;                image = new Image(godOne.getImage().getUrl());</b>
<i>195</i>&nbsp;        }
<b class="nc"><i>196</i>&nbsp;        else if (name.equals(nameTwo.getText())) {</b>
<b class="nc"><i>197</i>&nbsp;            if (godTwo.getImage() != null)</b>
<b class="nc"><i>198</i>&nbsp;                image = new Image(godTwo.getImage().getUrl());</b>
<i>199</i>&nbsp;        }
<b class="nc"><i>200</i>&nbsp;        else if (name.equals(nameThree.getText())) {</b>
<b class="nc"><i>201</i>&nbsp;            if (godThree.getImage() != null)</b>
<b class="nc"><i>202</i>&nbsp;                image = new Image(godThree.getImage().getUrl());</b>
<i>203</i>&nbsp;        }
<i>204</i>&nbsp;
<b class="nc"><i>205</i>&nbsp;        return image;</b>
<i>206</i>&nbsp;    }
<i>207</i>&nbsp;
<i>208</i>&nbsp;    /** Sets the cards on the left side of the scene depending on the number of players, their names, colors
<i>209</i>&nbsp;     * and gods chosen. The lists given as parameters are in matching corresponding order
<i>210</i>&nbsp;     * @param godsList is the list of gods
<i>211</i>&nbsp;     * @param playersList is the list of players&#39; names
<i>212</i>&nbsp;     * @param colorsList is the list of colors
<i>213</i>&nbsp;     */
<i>214</i>&nbsp;    public void updateCards(String[] godsList, String[] playersList, PlayerColor[] colorsList){
<b class="nc"><i>215</i>&nbsp;        ImageView[] cards = new ImageView[]{cardOne, cardTwo, cardThree};</b>
<b class="nc"><i>216</i>&nbsp;        Label[] names = new Label[]{nameOne, nameTwo, nameThree};</b>
<b class="nc"><i>217</i>&nbsp;        ImageView[] gods = new ImageView[]{godOne, godTwo, godThree};</b>
<b class="nc"><i>218</i>&nbsp;        ImageView[] powers = new ImageView[]{powerOne, powerTwo, powerThree};</b>
<b class="nc"><i>219</i>&nbsp;        for (int i = 0; i &lt; godsList.length; i++){</b>
<b class="nc"><i>220</i>&nbsp;            names[i].setText(playersList[i]);</b>
<b class="nc"><i>221</i>&nbsp;            names[i].setId(&quot;boardPlayerName&quot;);</b>
<b class="nc"><i>222</i>&nbsp;            if (colorsList[i] == PlayerColor.BLUE) {</b>
<b class="nc"><i>223</i>&nbsp;                cards[i].setImage(new Image(&quot;/images/cards/CompleteCardBlue.png&quot;, 189, 280, true, true));</b>
<i>224</i>&nbsp;            }
<b class="nc"><i>225</i>&nbsp;            else if (colorsList[i] == PlayerColor.MAGENTA){</b>
<b class="nc"><i>226</i>&nbsp;                cards[i].setImage(new Image(&quot;/images/cards/CompleteCardMagenta.png&quot;, 189, 280, true, true));</b>
<i>227</i>&nbsp;            }
<b class="nc"><i>228</i>&nbsp;            else if (colorsList[i] == PlayerColor.RED) {</b>
<b class="nc"><i>229</i>&nbsp;                cards[i].setImage(new Image(&quot;/images/cards/CompleteCardRed.png&quot;, 189, 280, true, true));</b>
<i>230</i>&nbsp;            }
<b class="nc"><i>231</i>&nbsp;            powers[i].setImage(new Image(GodPath.getPower(godsList[i]), 149, 60, true, true));</b>
<b class="nc"><i>232</i>&nbsp;            gods[i].setImage(new Image(GodPath.getPath(godsList[i]), 105, 137, true, true));</b>
<b class="nc"><i>233</i>&nbsp;            Tooltip powerTooltip = new Tooltip(GodDescription.getPower(godsList[i]));</b>
<b class="nc"><i>234</i>&nbsp;            Tooltip.install(powers[i],powerTooltip);</b>
<b class="nc"><i>235</i>&nbsp;            powerTooltip.setShowDelay(Duration.seconds(0.01));</b>
<b class="nc"><i>236</i>&nbsp;            powerTooltip.setMaxWidth(200);</b>
<i>237</i>&nbsp;        }
<i>238</i>&nbsp;
<i>239</i>&nbsp;    }
<i>240</i>&nbsp;
<i>241</i>&nbsp;    /** Enables or disables the tiles depending on the presence of other players.
<i>242</i>&nbsp;     * @param sex is the sex of the worker that the player is positioning on the board
<i>243</i>&nbsp;     * @param alreadyOccupied is the matrix of workers already on the board
<i>244</i>&nbsp;     */
<i>245</i>&nbsp;    public void updatePlaceWorker(Sex sex, Sex[][] alreadyOccupied){
<b class="nc"><i>246</i>&nbsp;        currentPhase = CurrentPhase.PLACE_WORKER;</b>
<b class="nc"><i>247</i>&nbsp;        this.answerSex = sex;</b>
<b class="nc"><i>248</i>&nbsp;        for (int i = 0; i &lt; Constant.DIM; i++){</b>
<b class="nc"><i>249</i>&nbsp;            for (int j = 0; j &lt; Constant.DIM; j++){</b>
<b class="nc"><i>250</i>&nbsp;                if (alreadyOccupied[i][j] == null){</b>
<b class="nc"><i>251</i>&nbsp;                    enableTile(i, j);</b>
<i>252</i>&nbsp;                }
<i>253</i>&nbsp;                else{
<b class="nc"><i>254</i>&nbsp;                    disableTile(i, j);</b>
<i>255</i>&nbsp;                }
<i>256</i>&nbsp;            }
<i>257</i>&nbsp;        }
<i>258</i>&nbsp;    }
<i>259</i>&nbsp;
<i>260</i>&nbsp;    /** Shows and enables the toggle button for the choice of the power
<i>261</i>&nbsp;     */
<i>262</i>&nbsp;    public void updatePower(){
<b class="nc"><i>263</i>&nbsp;        togglePower.setVisible(true);</b>
<b class="nc"><i>264</i>&nbsp;        submitPower.setVisible(true);</b>
<b class="nc"><i>265</i>&nbsp;        submitPower.setDisable(false);</b>
<b class="nc"><i>266</i>&nbsp;        togglePower.setDisable(false);</b>
<b class="nc"><i>267</i>&nbsp;        togglePower.setSelected(false);</b>
<i>268</i>&nbsp;    }
<i>269</i>&nbsp;
<i>270</i>&nbsp;    /** Sets the victory message showing the winner god
<i>271</i>&nbsp;     * @param winner is the winner
<i>272</i>&nbsp;     * @param loser is the loser, if there is any. Otherwise, is an empty string
<i>273</i>&nbsp;     */
<i>274</i>&nbsp;    public void updateWin(String winner, String loser){
<i>275</i>&nbsp;        Image winnerGod;
<b class="nc"><i>276</i>&nbsp;        FadeTransition transOverlay = new FadeTransition(Duration.seconds(2), blackOverlay);</b>
<b class="nc"><i>277</i>&nbsp;        transOverlay.setFromValue(.20);</b>
<b class="nc"><i>278</i>&nbsp;        transOverlay.setToValue(1);</b>
<b class="nc"><i>279</i>&nbsp;        transOverlay.play();</b>
<b class="nc"><i>280</i>&nbsp;        pane.getChildren().add(blackOverlay);;</b>
<b class="nc"><i>281</i>&nbsp;        winnerGod = getGodImageByUser(winner);</b>
<b class="nc"><i>282</i>&nbsp;        ImageView winnerGodImageView = new ImageView(winnerGod);</b>
<b class="nc"><i>283</i>&nbsp;        if (winnerGod!=null) {</b>
<b class="nc"><i>284</i>&nbsp;            FadeTransition transGod = new FadeTransition(Duration.seconds(2), winnerGodImageView);</b>
<b class="nc"><i>285</i>&nbsp;            transGod.setFromValue(0);</b>
<b class="nc"><i>286</i>&nbsp;            transGod.setToValue(1);</b>
<b class="nc"><i>287</i>&nbsp;            transGod.play();</b>
<b class="nc"><i>288</i>&nbsp;            StackPane.setAlignment(winnerGodImageView, Pos.CENTER);</b>
<b class="nc"><i>289</i>&nbsp;            StackPane.setMargin(winnerGodImageView, new Insets(0,0,100,0));</b>
<b class="nc"><i>290</i>&nbsp;            pane.getChildren().add(winnerGodImageView);</b>
<i>291</i>&nbsp;        }
<b class="nc"><i>292</i>&nbsp;        ImageView victory = new ImageView(new Image(&quot;/images/victory.png&quot;, 1280, 720, true, true));</b>
<b class="nc"><i>293</i>&nbsp;        FadeTransition transVictory = new FadeTransition(Duration.seconds(2), victory);</b>
<b class="nc"><i>294</i>&nbsp;        transVictory.setFromValue(0);</b>
<b class="nc"><i>295</i>&nbsp;        transVictory.setToValue(1);</b>
<b class="nc"><i>296</i>&nbsp;        transVictory.play();</b>
<b class="nc"><i>297</i>&nbsp;        pane.getChildren().add(victory);</b>
<b class="nc"><i>298</i>&nbsp;        victoryMessage.setText(&quot;YOU WIN!&quot;);</b>
<b class="nc"><i>299</i>&nbsp;        StackPane.setAlignment( victoryMessage, Pos.BOTTOM_CENTER );</b>
<b class="nc"><i>300</i>&nbsp;        FadeTransition transMessage = new FadeTransition(Duration.seconds(2), victoryMessage);</b>
<b class="nc"><i>301</i>&nbsp;        transMessage.setFromValue(0);</b>
<b class="nc"><i>302</i>&nbsp;        transMessage.setToValue(1);</b>
<b class="nc"><i>303</i>&nbsp;        transMessage.play();</b>
<b class="nc"><i>304</i>&nbsp;        pane.getChildren().add(victoryMessage);</b>
<b class="nc"><i>305</i>&nbsp;        Label loserMessage = null;</b>
<b class="nc"><i>306</i>&nbsp;        if (!loser.isEmpty()){</b>
<b class="nc"><i>307</i>&nbsp;            setCardOpacity(loser, 0.4);</b>
<b class="nc"><i>308</i>&nbsp;            loserMessage = new Label(loser + &quot; lost!&quot;);</b>
<b class="nc"><i>309</i>&nbsp;            loserMessage.setId(&quot;loserLabel&quot;);</b>
<b class="nc"><i>310</i>&nbsp;            pane.getChildren().add(loserMessage);</b>
<b class="nc"><i>311</i>&nbsp;            StackPane.setAlignment(loserMessage, Pos.TOP_CENTER);</b>
<i>312</i>&nbsp;        }
<b class="nc"><i>313</i>&nbsp;        showButtonsEndGame(EndGameButtons.PLAY_AGAIN, winnerGodImageView, loserMessage);</b>
<i>314</i>&nbsp;    }
<i>315</i>&nbsp;
<i>316</i>&nbsp;    /** Sets the losing message
<i>317</i>&nbsp;     * @param winner is the winner name, if there is any. In this case, it shows the winner god.
<i>318</i>&nbsp;     *               Otherwise, if there is no winner, it is an empty string
<i>319</i>&nbsp;     * @param losers is the list of all the losers names, whose cards will be set with opacity, in order
<i>320</i>&nbsp;     *               to immediately recognize who is no longer in the game
<i>321</i>&nbsp;     */
<i>322</i>&nbsp;    public void updateLose(String winner, String[] losers){
<i>323</i>&nbsp;        ImageView victory;
<b class="nc"><i>324</i>&nbsp;        pane.getChildren().add(blackOverlay);</b>
<b class="nc"><i>325</i>&nbsp;        FadeTransition transOverlay = new FadeTransition(Duration.seconds(2), blackOverlay);</b>
<b class="nc"><i>326</i>&nbsp;        transOverlay.setFromValue(.20);</b>
<b class="nc"><i>327</i>&nbsp;        transOverlay.setToValue(1);</b>
<b class="nc"><i>328</i>&nbsp;        transOverlay.play();</b>
<b class="nc"><i>329</i>&nbsp;        Image winnerGod = getGodImageByUser(winner);</b>
<i>330</i>&nbsp;
<b class="nc"><i>331</i>&nbsp;        for (String loser : losers) {</b>
<b class="nc"><i>332</i>&nbsp;            setCardOpacity(loser, 0.4);</b>
<i>333</i>&nbsp;        }
<i>334</i>&nbsp;
<b class="nc"><i>335</i>&nbsp;        Label winnerName = new Label();</b>
<b class="nc"><i>336</i>&nbsp;        if (!winner.isEmpty()) {</b>
<b class="nc"><i>337</i>&nbsp;            victory  = new ImageView(new Image(&quot;images/victory.png&quot;, 1280, 720, true, true));</b>
<b class="nc"><i>338</i>&nbsp;            FadeTransition transVictory = new FadeTransition(Duration.seconds(2), victory);</b>
<b class="nc"><i>339</i>&nbsp;            transVictory.setFromValue(0);</b>
<b class="nc"><i>340</i>&nbsp;            transVictory.setToValue(1);</b>
<b class="nc"><i>341</i>&nbsp;            transVictory.play();</b>
<i>342</i>&nbsp;            ImageView winnerGodImageView;
<b class="nc"><i>343</i>&nbsp;            if (winnerGod!=null) {</b>
<b class="nc"><i>344</i>&nbsp;                winnerGodImageView = new ImageView(winnerGod);</b>
<b class="nc"><i>345</i>&nbsp;                StackPane.setAlignment(winnerGodImageView, Pos.CENTER);</b>
<b class="nc"><i>346</i>&nbsp;                StackPane.setMargin(winnerGodImageView, new Insets(0,0,100,0));</b>
<b class="nc"><i>347</i>&nbsp;                pane.getChildren().add(winnerGodImageView);</b>
<b class="nc"><i>348</i>&nbsp;                FadeTransition transGod = new FadeTransition(Duration.seconds(2), winnerGodImageView);</b>
<b class="nc"><i>349</i>&nbsp;                transGod.setFromValue(0);</b>
<b class="nc"><i>350</i>&nbsp;                transGod.setToValue(1);</b>
<b class="nc"><i>351</i>&nbsp;                transGod.play();</b>
<i>352</i>&nbsp;            }
<b class="nc"><i>353</i>&nbsp;            winnerName.setText(winner + &quot; won!&quot;);</b>
<b class="nc"><i>354</i>&nbsp;            winnerName.setId(&quot;loserLabel&quot;);</b>
<b class="nc"><i>355</i>&nbsp;            pane.getChildren().add(winnerName);</b>
<b class="nc"><i>356</i>&nbsp;            StackPane.setAlignment(winnerName, Pos.TOP_CENTER);</b>
<b class="nc"><i>357</i>&nbsp;            StackPane.setAlignment( victoryMessage, Pos.BOTTOM_CENTER );</b>
<b class="nc"><i>358</i>&nbsp;            victoryMessage.setText(&quot;GAME OVER&quot;);</b>
<b class="nc"><i>359</i>&nbsp;            showButtonsEndGame(EndGameButtons.PLAY_AGAIN, victory, winnerName);</b>
<b class="nc"><i>360</i>&nbsp;        }</b>
<i>361</i>&nbsp;        else{
<i>362</i>&nbsp;            //keep watching or quit
<b class="nc"><i>363</i>&nbsp;            victory = new ImageView(new Image(&quot;/images/defeat.png&quot;, 1280, 720, true, true));</b>
<b class="nc"><i>364</i>&nbsp;            showButtonsEndGame(EndGameButtons.KEEP_WATCHING, victory, winnerName);</b>
<b class="nc"><i>365</i>&nbsp;            StackPane.setAlignment( victoryMessage, Pos.CENTER );</b>
<b class="nc"><i>366</i>&nbsp;            victoryMessage.setId(&quot;personalDefeat&quot;);</b>
<b class="nc"><i>367</i>&nbsp;            victoryMessage.setText(&quot;YOU LOST&quot;);</b>
<i>368</i>&nbsp;        }
<b class="nc"><i>369</i>&nbsp;        pane.getChildren().add(victory);</b>
<b class="nc"><i>370</i>&nbsp;        pane.getChildren().add(victoryMessage);</b>
<b class="nc"><i>371</i>&nbsp;        FadeTransition transMessage = new FadeTransition(Duration.seconds(2), victoryMessage);</b>
<b class="nc"><i>372</i>&nbsp;        transMessage.setFromValue(0);</b>
<b class="nc"><i>373</i>&nbsp;        transMessage.setToValue(1);</b>
<b class="nc"><i>374</i>&nbsp;        transMessage.play();</b>
<i>375</i>&nbsp;    }
<i>376</i>&nbsp;
<i>377</i>&nbsp;    /** Shows the play again or keep watching button and the exit button at the end of a specific
<i>378</i>&nbsp;     *  player&#39;s game
<i>379</i>&nbsp;     * @param button it specifies if it is a play again or keep watching button
<i>380</i>&nbsp;     * @param victory is the victory image to delete from screen
<i>381</i>&nbsp;     * @param winnerName is the message to delete from screen
<i>382</i>&nbsp;     */
<i>383</i>&nbsp;    private void showButtonsEndGame(EndGameButtons button, ImageView victory, Label winnerName){
<b class="nc"><i>384</i>&nbsp;        Button quit = new Button();</b>
<b class="nc"><i>385</i>&nbsp;        quit.setContentDisplay(ContentDisplay.BOTTOM);</b>
<b class="nc"><i>386</i>&nbsp;        quit.setId(&quot;quit&quot;);</b>
<b class="nc"><i>387</i>&nbsp;        quit.setMinSize(70, 110);</b>
<b class="nc"><i>388</i>&nbsp;        quit.setMaxSize(70,110);</b>
<b class="nc"><i>389</i>&nbsp;        pane.getChildren().add(quit);</b>
<b class="nc"><i>390</i>&nbsp;        StackPane.setAlignment(quit, Pos.BOTTOM_LEFT);</b>
<b class="nc"><i>391</i>&nbsp;        StackPane.setMargin(quit, new Insets(0,0,15,10));</b>
<b class="nc"><i>392</i>&nbsp;        quit.addEventHandler(MouseEvent.MOUSE_CLICKED, event -&gt; System.exit(0));</b>
<i>393</i>&nbsp;
<b class="nc"><i>394</i>&nbsp;        Button continueGame = new Button();</b>
<b class="nc"><i>395</i>&nbsp;        if(button == EndGameButtons.KEEP_WATCHING)</b>
<b class="nc"><i>396</i>&nbsp;            continueGame.setId(&quot;keepWatching&quot;);</b>
<b class="nc"><i>397</i>&nbsp;        else if(button == EndGameButtons.PLAY_AGAIN)</b>
<b class="nc"><i>398</i>&nbsp;            continueGame.setId(&quot;playAgain&quot;);</b>
<b class="nc"><i>399</i>&nbsp;        continueGame.setContentDisplay(ContentDisplay.BOTTOM);</b>
<i>400</i>&nbsp;
<b class="nc"><i>401</i>&nbsp;        continueGame.setMinSize(75, 110);</b>
<b class="nc"><i>402</i>&nbsp;        continueGame.setMaxSize(75, 110);</b>
<i>403</i>&nbsp;
<b class="nc"><i>404</i>&nbsp;        pane.getChildren().add(continueGame);</b>
<b class="nc"><i>405</i>&nbsp;        StackPane.setAlignment(continueGame, Pos.BOTTOM_LEFT);</b>
<b class="nc"><i>406</i>&nbsp;        StackPane.setMargin(continueGame, new Insets(0, 0,10,110));</b>
<i>407</i>&nbsp;
<b class="nc"><i>408</i>&nbsp;        if (button == EndGameButtons.KEEP_WATCHING) {</b>
<b class="nc"><i>409</i>&nbsp;            continueGame.addEventHandler(MouseEvent.MOUSE_CLICKED, event -&gt; {</b>
<b class="nc"><i>410</i>&nbsp;                pane.getChildren().remove(continueGame);</b>
<b class="nc"><i>411</i>&nbsp;                pane.getChildren().remove(quit);</b>
<b class="nc"><i>412</i>&nbsp;                pane.getChildren().remove(victoryMessage);</b>
<b class="nc"><i>413</i>&nbsp;                pane.getChildren().remove(winnerName);</b>
<b class="nc"><i>414</i>&nbsp;                pane.getChildren().remove(victory);</b>
<b class="nc"><i>415</i>&nbsp;                pane.getChildren().remove(blackOverlay);</b>
<b class="nc"><i>416</i>&nbsp;                GUIRequestHub.getInstance().setCanHandleRequest(true);</b>
<i>417</i>&nbsp;            });
<i>418</i>&nbsp;        }
<b class="nc"><i>419</i>&nbsp;        else if (button == EndGameButtons.PLAY_AGAIN){</b>
<b class="nc"><i>420</i>&nbsp;            continueGame.addEventHandler(MouseEvent.MOUSE_CLICKED, event -&gt; {</b>
<b class="nc"><i>421</i>&nbsp;                GUIRequestHub.getInstance().setCanHandleRequest(true);</b>
<b class="nc"><i>422</i>&nbsp;                restart();</b>
<i>423</i>&nbsp;            });
<i>424</i>&nbsp;        }
<i>425</i>&nbsp;    }
<i>426</i>&nbsp;
<i>427</i>&nbsp;    /**
<i>428</i>&nbsp;     * Lets the game restart with the IP request.
<i>429</i>&nbsp;     */
<i>430</i>&nbsp;    public void restart(){
<b class="nc"><i>431</i>&nbsp;        pane.getChildren().removeAll();</b>
<b class="nc"><i>432</i>&nbsp;        Scene scene = GUIRequestHub.getInstance().getCurrentController().getPane().getScene();</b>
<b class="nc"><i>433</i>&nbsp;        ScenePath.setNextScene(scene, ScenePath.SERVER_LOGIN);</b>
<i>434</i>&nbsp;    }
<i>435</i>&nbsp;
<i>436</i>&nbsp;    /** Enables the interaction with a tile, depending on the game phase and the status of the tile
<i>437</i>&nbsp;     *  (enabled or disables)
<i>438</i>&nbsp;     * @param e is the mouse event of the click
<i>439</i>&nbsp;     */
<i>440</i>&nbsp;    public void onClickTile(MouseEvent e){
<b class="nc"><i>441</i>&nbsp;        int y = GridPane.getRowIndex((Node) e.getSource());</b>
<b class="nc"><i>442</i>&nbsp;        int x = GridPane.getColumnIndex((Node) e.getSource());</b>
<i>443</i>&nbsp;
<b class="nc"><i>444</i>&nbsp;        if (!canSend[x][y]) {</b>
<i>445</i>&nbsp;            return;
<i>446</i>&nbsp;        }
<i>447</i>&nbsp;
<b class="nc"><i>448</i>&nbsp;        Answer answerToSend = null;</b>
<b class="nc"><i>449</i>&nbsp;        switch (currentPhase){</b>
<i>450</i>&nbsp;            case PLACE_WORKER: //setup
<b class="nc"><i>451</i>&nbsp;                answerToSend = new AnswerPlaceWorker(answerSex, x, y);</b>
<b class="nc"><i>452</i>&nbsp;                break;</b>
<i>453</i>&nbsp;            case WORKER_CHOICE: //play action
<b class="nc"><i>454</i>&nbsp;                chooseActionWorker(x,y);</b>
<b class="nc"><i>455</i>&nbsp;                currentPhase = playActionPhase == TurnPhase.MOVE ? CurrentPhase.MOVE_REQUEST : CurrentPhase.BUILD_REQUEST;</b>
<b class="nc"><i>456</i>&nbsp;                break;</b>
<i>457</i>&nbsp;            case MOVE_REQUEST:
<i>458</i>&nbsp;            case BUILD_REQUEST:
<b class="nc"><i>459</i>&nbsp;                if ((answerSex == Sex.MALE &amp;&amp; x == femaleXAction &amp;&amp; y == femaleYAction)</b>
<i>460</i>&nbsp;                        || (answerSex == Sex.FEMALE &amp;&amp; x == maleXAction &amp;&amp; y == maleYAction))
<b class="nc"><i>461</i>&nbsp;                    chooseActionWorker(x, y);</b>
<i>462</i>&nbsp;                else {
<b class="nc"><i>463</i>&nbsp;                    if (answerSex == Sex.MALE)</b>
<b class="nc"><i>464</i>&nbsp;                        answerToSend = new AnswerAction(answerSex, Directions.offsetToDirection(x - maleXAction, y - maleYAction));</b>
<b class="nc"><i>465</i>&nbsp;                    else if (answerSex == Sex.FEMALE)</b>
<b class="nc"><i>466</i>&nbsp;                        answerToSend = new AnswerAction(answerSex, Directions.offsetToDirection(x - femaleXAction, y - femaleYAction));</b>
<i>467</i>&nbsp;                }
<i>468</i>&nbsp;                break;
<i>469</i>&nbsp;        }
<b class="nc"><i>470</i>&nbsp;        if (answerToSend != null){</b>
<b class="nc"><i>471</i>&nbsp;            disableAll();</b>
<b class="nc"><i>472</i>&nbsp;            GUIRequestHub.getInstance().sendAnswer(answerToSend);</b>
<i>473</i>&nbsp;        }
<i>474</i>&nbsp;
<i>475</i>&nbsp;    }
<i>476</i>&nbsp;
<i>477</i>&nbsp;    /** Sends the information about the willingness of using the power
<i>478</i>&nbsp;     * @param e is the action event of the click on the submit button
<i>479</i>&nbsp;     */
<i>480</i>&nbsp;    public void onClickSubmitPower(ActionEvent e){
<b class="nc"><i>481</i>&nbsp;        GUIRequestHub.getInstance().sendAnswer(new AnswerBooleanChoice(togglePower.isSelected()));</b>
<b class="nc"><i>482</i>&nbsp;        submitPower.setDisable(true);</b>
<b class="nc"><i>483</i>&nbsp;        togglePower.setDisable(true);</b>
<b class="nc"><i>484</i>&nbsp;        submitPower.setVisible(false);</b>
<b class="nc"><i>485</i>&nbsp;        togglePower.setVisible(false);</b>
<b class="nc"><i>486</i>&nbsp;        message.setVisible(false);</b>
<i>487</i>&nbsp;    }
<i>488</i>&nbsp;
<i>489</i>&nbsp;    /** Enables or disables only the tiles of the workers who can perform an action
<i>490</i>&nbsp;     * @param x is the column index
<i>491</i>&nbsp;     * @param y is the row index
<i>492</i>&nbsp;     */
<i>493</i>&nbsp;    private void chooseActionWorker(int x, int y){
<b class="nc"><i>494</i>&nbsp;        disableAll();</b>
<b class="nc"><i>495</i>&nbsp;        Directions[] chosenDirections = null;</b>
<b class="nc"><i>496</i>&nbsp;        if (x == maleXAction &amp;&amp; y == maleYAction){</b>
<b class="nc"><i>497</i>&nbsp;            answerSex = Sex.MALE;</b>
<b class="nc"><i>498</i>&nbsp;            chosenDirections = maleDirections;</b>
<b class="nc"><i>499</i>&nbsp;            if(femaleDirections.length &gt; 0)</b>
<b class="nc"><i>500</i>&nbsp;                enableTile(femaleXAction, femaleYAction);</b>
<i>501</i>&nbsp;        }
<b class="nc"><i>502</i>&nbsp;        else if (x == femaleXAction &amp;&amp; y == femaleYAction){</b>
<b class="nc"><i>503</i>&nbsp;            answerSex = Sex.FEMALE;</b>
<b class="nc"><i>504</i>&nbsp;            chosenDirections = femaleDirections;</b>
<b class="nc"><i>505</i>&nbsp;            if(maleDirections.length &gt; 0)</b>
<b class="nc"><i>506</i>&nbsp;                enableTile(maleXAction, maleYAction);</b>
<i>507</i>&nbsp;        }
<b class="nc"><i>508</i>&nbsp;        highlightPossibleTiles(x, y, chosenDirections);</b>
<i>509</i>&nbsp;    }
<i>510</i>&nbsp;
<i>511</i>&nbsp;    /** Gets the tile depending on its column and row indexes.
<i>512</i>&nbsp;     * @param x is the column index
<i>513</i>&nbsp;     * @param y is the row index
<i>514</i>&nbsp;     * @param gridPane is the gridPane selected
<i>515</i>&nbsp;     * @return the right tile
<i>516</i>&nbsp;     */
<i>517</i>&nbsp;    public Node getTileByIndex (final int x, final int y, GridPane gridPane) {
<b class="nc"><i>518</i>&nbsp;        Node myTile = null;</b>
<b class="nc"><i>519</i>&nbsp;        ObservableList&lt;Node&gt; board = gridPane.getChildren();</b>
<i>520</i>&nbsp;
<b class="nc"><i>521</i>&nbsp;        for (Node tile : board) {</b>
<b class="nc"><i>522</i>&nbsp;            if(GridPane.getRowIndex(tile) == y &amp;&amp; GridPane.getColumnIndex(tile) == x) {</b>
<b class="nc"><i>523</i>&nbsp;                myTile = tile;</b>
<b class="nc"><i>524</i>&nbsp;                break;</b>
<i>525</i>&nbsp;            }
<b class="nc"><i>526</i>&nbsp;        }</b>
<i>527</i>&nbsp;
<b class="nc"><i>528</i>&nbsp;        return myTile;</b>
<i>529</i>&nbsp;    }
<i>530</i>&nbsp;
<i>531</i>&nbsp;    /** Highlights only the possible tiles where the selected worker can perform an action
<i>532</i>&nbsp;     * @param startX is the column index of the worker
<i>533</i>&nbsp;     * @param startY is the row index of the worker
<i>534</i>&nbsp;     * @param possibleDirections is the array of possible directions
<i>535</i>&nbsp;     */
<i>536</i>&nbsp;    private void highlightPossibleTiles(int startX, int startY, Directions[] possibleDirections){
<b class="nc"><i>537</i>&nbsp;        if (possibleDirections == null){</b>
<b class="nc"><i>538</i>&nbsp;            GUIRequestHub.getInstance().showError(new ErrorMessage(&quot;C003&quot;, &quot;Fatal error.&quot;));</b>
<i>539</i>&nbsp;            return;
<i>540</i>&nbsp;        }
<b class="nc"><i>541</i>&nbsp;        for (Directions direction: possibleDirections){</b>
<b class="nc"><i>542</i>&nbsp;            int xOffset = Directions.directionToXOffset(direction);</b>
<b class="nc"><i>543</i>&nbsp;            int yOffset = Directions.directionToYOffset(direction);</b>
<b class="nc"><i>544</i>&nbsp;            enableTile(startX + xOffset, startY + yOffset);</b>
<i>545</i>&nbsp;        }
<i>546</i>&nbsp;    }
<i>547</i>&nbsp;
<i>548</i>&nbsp;    /**Enables the tile, allowing responsiveness on the tile
<i>549</i>&nbsp;     * @param x is the column index
<i>550</i>&nbsp;     * @param y is the row index
<i>551</i>&nbsp;     */
<i>552</i>&nbsp;    private void enableTile(int x, int y){
<b class="nc"><i>553</i>&nbsp;        canSend[x][y] = true;</b>
<b class="nc"><i>554</i>&nbsp;        ObservableList&lt;Node&gt; childrenStack = ((StackPane) getTileByIndex(x, y, gridTable)).getChildren();</b>
<b class="nc"><i>555</i>&nbsp;        int stackSize = childrenStack.size();</b>
<b class="nc"><i>556</i>&nbsp;        if (stackSize == 0){</b>
<b class="nc"><i>557</i>&nbsp;            childrenStack.add(new ImageView(overlay));</b>
<b class="nc"><i>558</i>&nbsp;            stackSize = childrenStack.size();</b>
<i>559</i>&nbsp;        }
<i>560</i>&nbsp;
<b class="nc"><i>561</i>&nbsp;        if (childrenStack.get(stackSize-1).getId() != null &amp;&amp; (childrenStack.get(stackSize-1).getId().equals(&quot;workerOnBoard&quot;)</b>
<b class="nc"><i>562</i>&nbsp;                ||  childrenStack.get(stackSize-1).getId().equals(&quot;highlightWorker&quot;))) {</b>
<b class="nc"><i>563</i>&nbsp;            childrenStack.get(stackSize - 2).setId(&quot;enabledTile&quot;);</b>
<b class="nc"><i>564</i>&nbsp;            childrenStack.get(stackSize - 1).setId(&quot;highlightWorker&quot;);</b>
<i>565</i>&nbsp;        }
<i>566</i>&nbsp;        else
<b class="nc"><i>567</i>&nbsp;            childrenStack.get(stackSize-1).setId(&quot;enabledTile&quot;);</b>
<i>568</i>&nbsp;    }
<i>569</i>&nbsp;
<i>570</i>&nbsp;    /** Disables responsiveness on the tile
<i>571</i>&nbsp;     * @param x is the column index
<i>572</i>&nbsp;     * @param y is the row index
<i>573</i>&nbsp;     */
<i>574</i>&nbsp;    private void disableTile(int x, int y){
<b class="nc"><i>575</i>&nbsp;        canSend[x][y] = false;</b>
<b class="nc"><i>576</i>&nbsp;        ObservableList&lt;Node&gt; childrenStack = ((StackPane) getTileByIndex(x, y, gridTable)).getChildren();</b>
<b class="nc"><i>577</i>&nbsp;        int stackSize = childrenStack.size();</b>
<b class="nc"><i>578</i>&nbsp;        if (stackSize == 0){</b>
<b class="nc"><i>579</i>&nbsp;            childrenStack.add(new ImageView(overlay));</b>
<b class="nc"><i>580</i>&nbsp;            stackSize = childrenStack.size();</b>
<i>581</i>&nbsp;        }
<i>582</i>&nbsp;
<b class="nc"><i>583</i>&nbsp;        if (childrenStack.get(stackSize-1).getId() != null &amp;&amp; (childrenStack.get(stackSize-1).getId().equals(&quot;workerOnBoard&quot;) ||</b>
<b class="nc"><i>584</i>&nbsp;                childrenStack.get(stackSize-1).getId().equals(&quot;highlightWorker&quot;))) {</b>
<b class="nc"><i>585</i>&nbsp;            childrenStack.get(stackSize - 2).setId(&quot;disabledTile&quot;);</b>
<b class="nc"><i>586</i>&nbsp;            childrenStack.get(stackSize - 1).setId(&quot;workerOnBoard&quot;);</b>
<i>587</i>&nbsp;        }
<i>588</i>&nbsp;        else
<b class="nc"><i>589</i>&nbsp;            childrenStack.get(stackSize-1).setId(&quot;disabledTile&quot;);</b>
<i>590</i>&nbsp;    }
<i>591</i>&nbsp;
<i>592</i>&nbsp;    private void disableAll(){
<b class="nc"><i>593</i>&nbsp;        for (int i = 0; i &lt; Constant.DIM; i++){</b>
<b class="nc"><i>594</i>&nbsp;            for (int j = 0; j &lt; Constant.DIM; j++){</b>
<b class="nc"><i>595</i>&nbsp;                disableTile(i, j);</b>
<i>596</i>&nbsp;            }
<i>597</i>&nbsp;        }
<i>598</i>&nbsp;    }
<i>599</i>&nbsp;
<b class="nc"><i>600</i>&nbsp;    private int[][] savedBuildings = new int[Constant.DIM][Constant.DIM];</b>
<b class="nc"><i>601</i>&nbsp;    private Sex[][] savedWorkers = new Sex[Constant.DIM][Constant.DIM];</b>
<b class="nc"><i>602</i>&nbsp;    private boolean[][] savedDomes = new boolean[Constant.DIM][Constant.DIM];</b>
<b class="nc"><i>603</i>&nbsp;    private PlayerColor[][] savedColors = new PlayerColor[Constant.DIM][Constant.DIM];</b>
<i>604</i>&nbsp;
<i>605</i>&nbsp;    /** Saves and prints the changed tiles of the updated board
<i>606</i>&nbsp;     * @param slimBoard is the slimboard received from the server
<i>607</i>&nbsp;     */
<i>608</i>&nbsp;    public void updateAndSaveBoard(SlimBoard slimBoard) {
<b class="nc"><i>609</i>&nbsp;        int[][] buildings = slimBoard.getBuilding();</b>
<b class="nc"><i>610</i>&nbsp;        boolean[][] domes = slimBoard.getDome();</b>
<b class="nc"><i>611</i>&nbsp;        Sex[][] sexes = slimBoard.getSex();</b>
<b class="nc"><i>612</i>&nbsp;        PlayerColor[][] colors = slimBoard.getColor();</b>
<i>613</i>&nbsp;
<b class="nc"><i>614</i>&nbsp;        for (int i = 0; i &lt; Constant.DIM; i++) {</b>
<b class="nc"><i>615</i>&nbsp;            for (int j = 0; j &lt; Constant.DIM; j++) {</b>
<b class="nc"><i>616</i>&nbsp;                if (buildings[i][j] != savedBuildings[i][j]</b>
<i>617</i>&nbsp;                        || domes[i][j] != savedDomes[i][j]
<i>618</i>&nbsp;                        || sexes[i][j] != savedWorkers[i][j]
<i>619</i>&nbsp;                        || colors[i][j] != savedColors[i][j]){
<b class="nc"><i>620</i>&nbsp;                    savedBuildings[i][j] = buildings[i][j];</b>
<b class="nc"><i>621</i>&nbsp;                    savedDomes[i][j] = domes[i][j];</b>
<b class="nc"><i>622</i>&nbsp;                    savedWorkers[i][j] = sexes[i][j];</b>
<b class="nc"><i>623</i>&nbsp;                    savedColors[i][j] = colors[i][j];</b>
<i>624</i>&nbsp;
<b class="nc"><i>625</i>&nbsp;                    printSavedTile(i, j);</b>
<i>626</i>&nbsp;                }
<i>627</i>&nbsp;            }
<i>628</i>&nbsp;        }
<i>629</i>&nbsp;    }
<i>630</i>&nbsp;
<b class="nc"><i>631</i>&nbsp;    private Directions[] maleDirections = null;</b>
<b class="nc"><i>632</i>&nbsp;    private Directions[] femaleDirections = null;</b>
<i>633</i>&nbsp;    private int maleXAction;
<i>634</i>&nbsp;    private int maleYAction;
<i>635</i>&nbsp;    private int femaleXAction;
<i>636</i>&nbsp;    private int femaleYAction;
<b class="nc"><i>637</i>&nbsp;    private TurnPhase playActionPhase = null;</b>
<i>638</i>&nbsp;
<i>639</i>&nbsp;    /**
<i>640</i>&nbsp;     * Updates the worker&#39;s choice depending on the possible actions.
<i>641</i>&nbsp;     * @param request   Action to be managed.
<i>642</i>&nbsp;     */
<i>643</i>&nbsp;    public void updatePlayAction(RequestAction request){
<b class="nc"><i>644</i>&nbsp;        maleDirections = request.getPossibleMaleDirections();</b>
<b class="nc"><i>645</i>&nbsp;        femaleDirections = request.getPossibleFemaleDirections();</b>
<b class="nc"><i>646</i>&nbsp;        maleXAction = request.getXMale();</b>
<b class="nc"><i>647</i>&nbsp;        maleYAction = request.getYMale();</b>
<b class="nc"><i>648</i>&nbsp;        femaleXAction = request.getXFemale();</b>
<b class="nc"><i>649</i>&nbsp;        femaleYAction = request.getYFemale();</b>
<b class="nc"><i>650</i>&nbsp;        playActionPhase = request.getNextPhase();</b>
<i>651</i>&nbsp;
<b class="nc"><i>652</i>&nbsp;        currentPhase = CurrentPhase.WORKER_CHOICE;</b>
<i>653</i>&nbsp;
<b class="nc"><i>654</i>&nbsp;        if (request.getRequiredActions()[0] == RequiredActions.REQUEST_WORKER){</b>
<b class="nc"><i>655</i>&nbsp;            if (request.getPossibleMaleDirections().length &gt; 0)</b>
<b class="nc"><i>656</i>&nbsp;                enableTile(request.getXMale(), request.getYMale());</b>
<b class="nc"><i>657</i>&nbsp;            if (request.getPossibleFemaleDirections().length &gt; 0)</b>
<b class="nc"><i>658</i>&nbsp;                enableTile(request.getXFemale(), request.getYFemale());</b>
<i>659</i>&nbsp;        }
<b class="nc"><i>660</i>&nbsp;        else if (request.getRequiredActions()[0] == RequiredActions.REQUIRED_MALE)</b>
<b class="nc"><i>661</i>&nbsp;            enableTile(request.getXMale(), request.getYMale());</b>
<b class="nc"><i>662</i>&nbsp;        else if (request.getRequiredActions()[0] == RequiredActions.REQUIRED_FEMALE)</b>
<b class="nc"><i>663</i>&nbsp;            enableTile(request.getXFemale(), request.getYFemale());</b>
<i>664</i>&nbsp;    }
<i>665</i>&nbsp;
<b class="nc"><i>666</i>&nbsp;    private final Image maleRed = new Image(&quot;/images/workers/maleRed.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>667</i>&nbsp;    private final Image femaleRed = new Image(&quot;/images/workers/femaleRed.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>668</i>&nbsp;    private final Image maleBlue = new Image(&quot;/images/workers/maleBlue.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>669</i>&nbsp;    private final Image femaleBlue = new Image(&quot;/images/workers/femaleBlue.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>670</i>&nbsp;    private final Image maleMagenta = new Image(&quot;/images/workers/maleMagenta.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>671</i>&nbsp;    private final Image femaleMagenta = new Image(&quot;/images/workers/femaleMagenta.png&quot;, 109.5, 109.5, true, true);</b>
<i>672</i>&nbsp;
<b class="nc"><i>673</i>&nbsp;    private final Image levelGround = new Image(&quot;/images/buildings/empty.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>674</i>&nbsp;    private final Image levelOne = new Image(&quot;/images/buildings/level1.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>675</i>&nbsp;    private final Image levelTwo = new Image(&quot;/images/buildings/level2.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>676</i>&nbsp;    private final Image levelThree = new Image(&quot;/images/buildings/level3.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>677</i>&nbsp;    private final Image dome = new Image(&quot;/images/buildings/dome.png&quot;, 109.5, 109.5, true, true);</b>
<b class="nc"><i>678</i>&nbsp;    private final Image overlay = new Image(&quot;/images/buildings/overlay.png&quot;, 109.5, 109.5, true, true);</b>
<i>679</i>&nbsp;
<i>680</i>&nbsp;    private void printSavedTile(int x, int y){
<b class="nc"><i>681</i>&nbsp;        StackPane tile = (StackPane) getTileByIndex(x,y, gridTable);</b>
<b class="nc"><i>682</i>&nbsp;        ObservableList&lt;Node&gt; list = tile.getChildren();</b>
<b class="nc"><i>683</i>&nbsp;        list.clear();</b>
<b class="nc"><i>684</i>&nbsp;        printBuilding(x, y, list);</b>
<b class="nc"><i>685</i>&nbsp;        printWorker(x, y, list);</b>
<i>686</i>&nbsp;    }
<i>687</i>&nbsp;
<i>688</i>&nbsp;    private void printBuilding(int x, int y, ObservableList&lt;Node&gt; list){
<b class="nc"><i>689</i>&nbsp;        int buildingToPrint = savedBuildings[x][y];</b>
<b class="nc"><i>690</i>&nbsp;        ArrayList&lt;Image&gt; buildingImages = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>691</i>&nbsp;        switch (buildingToPrint){</b>
<i>692</i>&nbsp;            case 0:
<b class="nc"><i>693</i>&nbsp;                buildingImages.add(levelGround);</b>
<b class="nc"><i>694</i>&nbsp;                break;</b>
<i>695</i>&nbsp;            case 1:
<b class="nc"><i>696</i>&nbsp;                buildingImages.add(levelOne);</b>
<b class="nc"><i>697</i>&nbsp;                break;</b>
<i>698</i>&nbsp;            case 2:
<b class="nc"><i>699</i>&nbsp;                buildingImages.add(levelTwo);</b>
<b class="nc"><i>700</i>&nbsp;                break;</b>
<i>701</i>&nbsp;            case 3:
<b class="nc"><i>702</i>&nbsp;                buildingImages.add(levelThree);</b>
<i>703</i>&nbsp;                break;
<i>704</i>&nbsp;        }
<b class="nc"><i>705</i>&nbsp;        if (savedDomes[x][y])</b>
<b class="nc"><i>706</i>&nbsp;            buildingImages.add(dome);</b>
<i>707</i>&nbsp;
<b class="nc"><i>708</i>&nbsp;        buildingImages.add(overlay);</b>
<i>709</i>&nbsp;
<b class="nc"><i>710</i>&nbsp;        for (Image image: buildingImages){</b>
<b class="nc"><i>711</i>&nbsp;            ImageView imageView = new ImageView(image);</b>
<b class="nc"><i>712</i>&nbsp;            list.add(imageView);</b>
<b class="nc"><i>713</i>&nbsp;            if (image.equals(overlay))</b>
<b class="nc"><i>714</i>&nbsp;                imageView.setId(&quot;disabledTile&quot;);</b>
<b class="nc"><i>715</i>&nbsp;        }</b>
<i>716</i>&nbsp;
<i>717</i>&nbsp;    }
<i>718</i>&nbsp;
<i>719</i>&nbsp;    private void printWorker(int x, int y, ObservableList&lt;Node&gt; list){
<b class="nc"><i>720</i>&nbsp;        Sex sexToPrint = savedWorkers[x][y];</b>
<b class="nc"><i>721</i>&nbsp;        PlayerColor colorToPrint = savedColors[x][y];</b>
<b class="nc"><i>722</i>&nbsp;        Image workerImage = null;</b>
<i>723</i>&nbsp;
<b class="nc"><i>724</i>&nbsp;        if (sexToPrint == null || colorToPrint == null){</b>
<i>725</i>&nbsp;            return;
<i>726</i>&nbsp;        }
<i>727</i>&nbsp;
<b class="nc"><i>728</i>&nbsp;        if (sexToPrint == Sex.MALE){</b>
<b class="nc"><i>729</i>&nbsp;            switch (colorToPrint){</b>
<i>730</i>&nbsp;                case BLUE:
<b class="nc"><i>731</i>&nbsp;                    workerImage = maleBlue;</b>
<b class="nc"><i>732</i>&nbsp;                    break;</b>
<i>733</i>&nbsp;                case MAGENTA:
<b class="nc"><i>734</i>&nbsp;                    workerImage = maleMagenta;</b>
<b class="nc"><i>735</i>&nbsp;                    break;</b>
<i>736</i>&nbsp;                case RED:
<b class="nc"><i>737</i>&nbsp;                    workerImage = maleRed;</b>
<b class="nc"><i>738</i>&nbsp;                    break;</b>
<i>739</i>&nbsp;            }
<i>740</i>&nbsp;        }
<b class="nc"><i>741</i>&nbsp;        else  if (sexToPrint == Sex.FEMALE){</b>
<b class="nc"><i>742</i>&nbsp;            switch (colorToPrint){</b>
<i>743</i>&nbsp;                case BLUE:
<b class="nc"><i>744</i>&nbsp;                    workerImage = femaleBlue;</b>
<b class="nc"><i>745</i>&nbsp;                    break;</b>
<i>746</i>&nbsp;                case MAGENTA:
<b class="nc"><i>747</i>&nbsp;                    workerImage = femaleMagenta;</b>
<b class="nc"><i>748</i>&nbsp;                    break;</b>
<i>749</i>&nbsp;                case RED:
<b class="nc"><i>750</i>&nbsp;                    workerImage = femaleRed;</b>
<i>751</i>&nbsp;                    break;
<i>752</i>&nbsp;            }
<i>753</i>&nbsp;        }
<i>754</i>&nbsp;
<b class="nc"><i>755</i>&nbsp;        if (workerImage != null) {</b>
<b class="nc"><i>756</i>&nbsp;            ImageView imageView = new ImageView(workerImage);</b>
<b class="nc"><i>757</i>&nbsp;            list.add(imageView);</b>
<b class="nc"><i>758</i>&nbsp;            imageView.setId(&quot;workerOnBoard&quot;);</b>
<i>759</i>&nbsp;        }
<i>760</i>&nbsp;    }
<i>761</i>&nbsp;
<i>762</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2020-07-03 15:31</div>
</div>
</body>
</html>
